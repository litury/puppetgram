# Устранение неполадок Telegram User Bot

## Проблемы с подключением к Telegram

### FloodWait ошибки

**Симптомы:**
```
[INFO] - [Sleeping for 15s on flood wait (Caused by messages.GetDialogs)]
FLOOD_WAIT: подождите 17 секунд и попробуйте снова
```

**Причины:**
- Слишком частые запросы к Telegram API
- Превышение лимитов на получение диалогов
- Одновременное выполнение нескольких скриптов

**Решения:**
1. **Дождитесь автоматически** - система сама выждет указанное время
2. **Увеличьте паузы** - отредактируйте параметры пауз в скриптах
3. **Запускайте скрипты по очереди** - не одновременно
4. **Уменьшите batch size** - обрабатывайте меньше элементов за раз

### Ошибки аутентификации

**Симптомы:**
```
AUTH_KEY_INVALID: Invalid authorization key
SESSION_PASSWORD_NEEDED: Two-step verification is enabled
```

**Решения:**
1. **Пересоздайте сессию:**
   ```bash
   npm run session:generate
   ```

2. **Настройте 2FA:**
   ```bash
   npm run account:setup-2fa
   ```

3. **Проверьте .env файл:**
   ```env
   API_ID=your_real_api_id
   API_HASH=your_real_api_hash
   ACCOUNT_1_SESSION=valid_session_string
   ```

### Проблемы с доступом к каналам

**Симптомы:**
```
CHANNEL_PRIVATE: You can't view this channel
USER_NOT_PARTICIPANT: The user is not a participant of this chat
```

**Решения:**
1. **Проверьте подписку** на канал через официальный клиент
2. **Убедитесь в публичности** канала или наличии доступа
3. **Обновите список подписок** перед анализом

---

## Проблемы с AI сервисами

### Отсутствует API ключ

**Симптомы:**
```
Не найден DEEPSEEK_API_KEY в переменных окружения!
API ключ не введен
```

**Решения:**
1. **Добавьте ключ в .env:**
   ```env
   DEEPSEEK_API_KEY=sk-ваш-ключ-здесь
   OPENAI_API_KEY=sk-альтернативный-ключ
   ```

2. **Проверьте формат ключа** - должен начинаться с `sk-`

3. **Перезапустите терминал** после изменения .env

### Rate Limit ошибки AI

**Симптомы:**
```
Rate limit exceeded
Too Many Requests
Error 429
```

**Решения:**
1. **Подождите 1-5 минут** перед повторным запуском
2. **Используйте альтернативный провайдер:**
   - Deepseek → OpenAI
   - OpenAI → Deepseek
3. **Увеличьте паузы между запросами** в настройках скриптов

### Timeout ошибки

**Симптомы:**
```
Request timeout
ECONNABORTED
API Error: Timeout
```

**Решения:**
1. **Проверьте интернет-соединение**
2. **Увеличьте timeout в конфиге:**
   ```typescript
   timeout: 30000 // 30 секунд вместо 15
   ```

---

## Проблемы с данными и файлами

### Пустые результаты анализа

**Симптомы:**
```
Нет каналов для анализа
Нет постов для анализа
Found 0 channels
```

**Причины и решения:**

1. **Неправильный тип аккаунта:**
   - Проблема: Аккаунт не подписан на broadcast каналы
   - Решение: Подпишитесь на публичные каналы через @username

2. **Фильтрация типов диалогов:**
   - Проблема: Скрипт ищет каналы, но находит только группы
   - Решение: Используйте `filter:groups` для групп и `filter:auto` для каналов

3. **Приватные каналы:**
   - Проблема: Нет доступа к сообщениям
   - Решение: Убедитесь в наличии прав на чтение сообщений

### Ошибки файловой системы

**Симптомы:**
```
ENOENT: no such file or directory
Permission denied
Cannot write to exports/
```

**Решения:**
1. **Создайте папку exports:**
   ```bash
   mkdir exports
   ```

2. **Проверьте права доступа:**
   ```bash
   chmod 755 exports/
   ```

3. **Запустите от имени администратора** (если требуется)

---

## Проблемы производительности

### Медленная работа скриптов

**Симптомы:**
- Долгое выполнение скриптов
- Частые паузы
- Высокое потребление ресурсов

**Оптимизация:**

1. **Уменьшите количество анализируемых элементов:**
   ```javascript
   // Вместо анализа 100 каналов
   const limit = 50;

   // Вместо 10 постов на канал
   const postsLimit = 5;
   ```

2. **Увеличьте размер пакетов (осторожно):**
   ```javascript
   const batchSize = 2; // Начните с малого
   ```

3. **Используйте кеширование результатов** - не анализируйте повторно

### Превышение лимитов памяти

**Симптомы:**
```
JavaScript heap out of memory
Process killed
```

**Решения:**
1. **Увеличьте лимит Node.js:**
   ```bash
   node --max-old-space-size=4096 script.js
   ```

2. **Обрабатывайте данные пакетами** вместо загрузки всех сразу

3. **Очищайте неиспользуемые переменные**

---

## Проблемы с конфигурацией

### Неправильные переменные окружения

**Симптомы:**
```
Account not found
Invalid API credentials
Configuration error
```

**Проверочный список .env файла:**
```env
# Telegram API (обязательно)
API_ID=12345678
API_HASH=abc123def456...

# AI Services (минимум один)
DEEPSEEK_API_KEY=sk-...
OPENAI_API_KEY=sk-...

# Аккаунты (минимум один)
ACCOUNT_1_NAME=Основной аккаунт
ACCOUNT_1_SESSION=1BVtsOGwAA...
ACCOUNT_1_USERNAME=your_username

# Дополнительные аккаунты
ACCOUNT_2_NAME=Второй аккаунт
ACCOUNT_2_SESSION=1BVtsOGwBB...
```

### Ошибки TypeScript компиляции

**Симптомы:**
```
TSError: Unable to compile TypeScript
Property 'title' does not exist on type 'Entity'
```

**Решения:**
1. **Обновите зависимости:**
   ```bash
   npm update
   ```

2. **Переустановите пакеты:**
   ```bash
   rm -rf node_modules package-lock.json
   npm install
   ```

3. **Проверьте версию TypeScript:**
   ```bash
   npx tsc --version  # Должна быть 5.7+
   ```

---

## Диагностические команды

### Проверка системы

```bash
# Проверка версий
node --version    # v16+ требуется
npm --version     # v8+ рекомендуется

# Проверка зависимостей
npm list telegram
npm list openai
npm list @types/node

# Проверка TypeScript
npx tsc --noEmit  # Проверка без компиляции
```

### Тестирование подключений

```bash
# Тест Telegram подключения
npm run session:check-tdata

# Тест AI сервиса
npm run test:postmypost

# Полный анализ системы
npm run parse:dialogs
```

### Очистка и сброс

```bash
# Очистка кеша Node.js
npm cache clean --force

# Удаление временных файлов
rm -rf .tmp/ exports/*.tmp

# Сброс настроек (осторожно!)
cp .env.example .env
```

---

## Получение помощи

### Логирование проблем

1. **Сохраните вывод консоли:**
   ```bash
   npm run filter:auto > debug.log 2>&1
   ```

2. **Включите детальное логирование** в скриптах

3. **Запишите точные ошибки** и шаги воспроизведения

### Контактная информация

- **Техническая документация:** [README.md](../README.md)
- **Глоссарий терминов:** [glossary.md](../glossary.md)
- **Пошаговые инструкции:** [how-to/](../how-to/)

### Перед обращением за помощью

1. ✅ Проверили .env файл на правильность
2. ✅ Попробовали перезапустить скрипт
3. ✅ Проверили интернет-соединение
4. ✅ Изучили логи ошибок
5. ✅ Попробовали диагностические команды

---

*Версия руководства: 1.0.0*
*Дата обновления: 2025-01-14*